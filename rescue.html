<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Å‡∏π‡πâ‡∏†‡∏±‡∏¢ | SOS Rescue</title>
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, "Segoe UI", sans-serif;
      background: #f5f5f5;
      color: #222;
    }

    .header {
      background: #1976d2;
      color: #fff;
      padding: 14px 10px;
      text-align: center;
    }
    .header h1 {
      margin: 0;
      font-size: 20px;
    }
    .header p {
      margin: 4px 0 0;
      font-size: 13px;
      opacity: .95;
    }

    .container {
      max-width: 1100px;
      margin: 0 auto;
      padding: 10px 10px 24px;
    }

    .top-links {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      gap: 8px;
      font-size: 13px;
      margin-bottom: 8px;
    }
    .top-links a {
      color: #1565c0;
      text-decoration: none;
    }

    .filter-card, .legend-card {
      background: #ffffff;
      border-radius: 8px;
      padding: 8px 10px;
      box-shadow: 0 1px 4px rgba(0,0,0,0.08);
      margin-bottom: 10px;
      font-size: 13px;
    }
    .filter-card strong {
      font-size: 13px;
    }
    .filter-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 4px;
    }
    .filter-group {
      flex: 1;
      min-width: 120px;
    }
    .filter-card label {
      font-size: 12px;
      display: block;
      margin-bottom: 2px;
    }
    select, input[type="text"] {
      width: 100%;
      padding: 6px 7px;
      font-size: 13px;
      border-radius: 6px;
      border: 1px solid #ccc;
    }

    .legend-title {
      font-weight: 600;
      margin-bottom: 4px;
      font-size: 13px;
    }
    .legend-list {
      margin: 0;
      padding-left: 18px;
      font-size: 12px;
      color: #444;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      background: #ffffff;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 1px 4px rgba(0,0,0,0.1);
      font-size: 13px;
    }
    th, td {
      padding: 6px 6px;
      border-bottom: 1px solid #eee;
      text-align: left;
      vertical-align: top;
    }
    th {
      background: #e3f2fd;
      font-weight: 600;
      white-space: nowrap;
    }
    tr:last-child td {
      border-bottom: none;
    }

    .level-badge {
      display: inline-block;
      padding: 2px 6px;
      border-radius: 999px;
      font-size: 11px;
      font-weight: 600;
      color: #fff;
    }
    .level-1 { background: #8bc34a; }
    .level-2 { background: #4caf50; }
    .level-3 { background: #ffb300; }
    .level-4 { background: #fb8c00; }
    .level-5 { background: #e53935; }

    .btn-map, .btn-finish {
      display: inline-block;
      padding: 4px 8px;
      border-radius: 999px;
      border: none;
      font-size: 11px;
      cursor: pointer;
      text-decoration: none;
      white-space: nowrap;
      margin-bottom: 2px;
    }
    .btn-map {
      background: #1565c0;
      color: #fff;
    }
    .btn-finish {
      background: #2e7d32;
      color: #fff;
      margin-top: 4px;
    }

    .status-tag {
      display: inline-block;
      padding: 2px 6px;
      border-radius: 999px;
      font-size: 11px;
      background: #ef6c00;
      color: #fff;
      font-weight: 600;
    }

    .empty {
      text-align: center;
      padding: 14px;
      font-size: 13px;
      color: #777;
    }

    .footer {
      text-align: center;
      margin-top: 12px;
      font-size: 11px;
      color: #777;
    }

    @media (max-width: 720px) {
      th, td {
        font-size: 11px;
        padding: 5px 4px;
      }
      .header h1 { font-size: 18px; }
      .filter-group { min-width: 100px; }
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>üöë ‡∏£‡∏∞‡∏ö‡∏ö‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Å‡∏π‡πâ‡∏†‡∏±‡∏¢ - SOS</h1>
    <p>‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏Ñ‡∏™‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏õ‡∏¥‡∏î (status = "open") ‡∏à‡∏≤‡∏Å‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Firestore</p>
  </div>

  <div class="container">
    <div class="top-links">
      <div>‚¨ÖÔ∏è <a href="index.html">‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å‡∏£‡∏∞‡∏ö‡∏ö SOS</a></div>
      <div>‚úÖ <a href="history.html">‡∏î‡∏π‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ú‡∏π‡πâ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÅ‡∏•‡πâ‡∏ß</a></div>
    </div>

    <!-- ‡∏Å‡∏≤‡∏£‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏£‡∏á‡∏Å‡∏£‡∏∞‡πÅ‡∏™‡∏ô‡πâ‡∏≥ -->
    <div class="legend-card">
      <div class="legend-title">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏£‡∏á‡∏Ç‡∏≠‡∏á‡∏Å‡∏£‡∏∞‡πÅ‡∏™‡∏ô‡πâ‡∏≥</div>
      <ul class="legend-list">
        <li><strong>‡∏£‡∏∞‡∏î‡∏±‡∏ö 1</strong> ‚Äì ‡∏ô‡πâ‡∏≥‡πÅ‡∏ó‡∏ö‡πÑ‡∏°‡πà‡πÑ‡∏´‡∏• ‡πÄ‡∏î‡∏¥‡∏ô‡∏•‡∏∏‡∏¢‡πÑ‡∏î‡πâ‡∏™‡∏ö‡∏≤‡∏¢</li>
        <li><strong>‡∏£‡∏∞‡∏î‡∏±‡∏ö 2</strong> ‚Äì ‡∏ô‡πâ‡∏≥‡πÑ‡∏´‡∏•‡∏ä‡πâ‡∏≤ ‡∏£‡∏ñ‡πÄ‡∏•‡πá‡∏Å‡∏¢‡∏±‡∏á‡∏û‡∏≠‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏î‡πâ</li>
        <li><strong>‡∏£‡∏∞‡∏î‡∏±‡∏ö 3</strong> ‚Äì ‡∏ô‡πâ‡∏≥‡πÑ‡∏´‡∏•‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏°‡∏µ‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô ‡∏£‡∏∞‡∏ß‡∏±‡∏á‡πÄ‡∏î‡πá‡∏Å‡πÅ‡∏•‡∏∞‡∏ú‡∏π‡πâ‡∏™‡∏π‡∏á‡∏≠‡∏≤‡∏¢‡∏∏</li>
        <li><strong>‡∏£‡∏∞‡∏î‡∏±‡∏ö 4</strong> ‚Äì ‡∏ô‡πâ‡∏≥‡πÑ‡∏´‡∏•‡πÅ‡∏£‡∏á ‡∏£‡∏ñ‡∏ú‡πà‡∏≤‡∏ô‡∏¢‡∏≤‡∏Å ‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏ñ‡∏π‡∏Å‡∏û‡∏±‡∏î‡∏•‡πâ‡∏°</li>
        <li><strong>‡∏£‡∏∞‡∏î‡∏±‡∏ö 5</strong> ‚Äì ‡∏ô‡πâ‡∏≥‡πÑ‡∏´‡∏•‡πÅ‡∏£‡∏á‡∏°‡∏≤‡∏Å ‡∏≠‡∏±‡∏ô‡∏ï‡∏£‡∏≤‡∏¢‡∏™‡∏π‡∏á ‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï ‡∏´‡πâ‡∏≤‡∏°‡∏•‡∏á‡∏ô‡πâ‡∏≥‡πÄ‡∏≠‡∏á</li>
      </ul>
    </div>

    <!-- ‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• -->
    <div class="filter-card">
      <div><strong>‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏Ñ‡∏™‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÄ‡∏õ‡∏¥‡∏î‡∏≠‡∏¢‡∏π‡πà)</strong></div>
      <div class="filter-row">
        <div class="filter-group">
          <label>‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</label>
          <select id="filterProvince">
            <option value="">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
          </select>
        </div>
        <div class="filter-group">
          <label>‡∏≠‡∏≥‡πÄ‡∏†‡∏≠</label>
          <select id="filterDistrict">
            <option value="">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
          </select>
        </div>
        <div class="filter-group">
          <label>‡∏ï‡∏≥‡∏ö‡∏• / ‡πÄ‡∏Ç‡∏ï / ‡πÄ‡∏ó‡∏®‡∏ö‡∏≤‡∏•</label>
          <select id="filterSubdistrict">
            <option value="">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
          </select>
        </div>
        <div class="filter-group">
          <label>‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠ / ‡πÄ‡∏ö‡∏≠‡∏£‡πå</label>
          <input type="text" id="filterText" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏ö‡∏≤‡∏á‡∏™‡πà‡∏ß‡∏ô">
        </div>
      </div>
    </div>

    <!-- ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• -->
    <table>
      <thead>
        <tr>
          <th>#</th>
          <th>‡∏ä‡∏∑‡πà‡∏≠</th>
          <th>‡πÄ‡∏ö‡∏≠‡∏£‡πå</th>
          <th>‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà</th>
          <th>‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ô‡πâ‡∏≥</th>
          <th>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</th>
          <th>‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà / ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
          <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
        </tr>
      </thead>
      <tbody id="caseBody">
        <tr><td colspan="8" class="empty">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</td></tr>
      </tbody>
    </table>

    <div class="footer">
      Powered by Sarayut | SOS Rescue System
    </div>
  </div>

  <!-- Firebase config -->
  <script src="firebase-config.js"></script>

  <!-- Firebase ‡πÅ‡∏ö‡∏ö‡πÇ‡∏°‡∏î‡∏π‡∏• -->
  <script type="module">
    import { initializeApp } 
      from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import {
      getFirestore,
      collection,
      query,
      where,
      onSnapshot,
      doc,
      updateDoc,
      serverTimestamp
    } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

    // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô Firebase
    const app = initializeApp(firebaseConfig);
    const db  = getFirestore(app);
    console.log("Firebase initialized (rescue page)");

    const tbody          = document.getElementById('caseBody');
    const filterProvince = document.getElementById('filterProvince');
    const filterDistrict = document.getElementById('filterDistrict');
    const filterSubdist  = document.getElementById('filterSubdistrict');
    const filterText     = document.getElementById('filterText');

    let allCases = [];

    // subscribe ‡πÄ‡∏Ñ‡∏™‡∏ó‡∏µ‡πà status = open ‡πÅ‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå
    function subscribeOpenCases() {
      const q = query(
        collection(db, 'cases'),
        where('status', '==', 'open')
      );

      onSnapshot(q, (snap) => {
        allCases = snap.docs.map(doc => ({ id: doc.id, ...doc.data() }));
        console.log("‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÄ‡∏Ñ‡∏™ open:", allCases.length, "‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£");
        buildFilterOptions();
        renderTable();
      }, (err) => {
        console.error("‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß:", err);
        tbody.innerHTML = `
          <tr><td colspan="8" class="empty">
            ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏´‡∏ô‡πâ‡∏≤‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á
          </td></tr>`;
      });
    }

    // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î/‡∏≠‡∏≥‡πÄ‡∏†‡∏≠/‡∏ï‡∏≥‡∏ö‡∏• ‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á
    function buildFilterOptions() {
      const provinces = new Set();
      const districts = new Set();
      const subs      = new Set();

      allCases.forEach(c => {
        const r = c.region || {};
        if (r.province)    provinces.add(r.province);
        if (r.district)    districts.add(r.district);
        if (r.subdistrict) subs.add(r.subdistrict);
      });

      function fillSelect(selectEl, values) {
        const current = selectEl.value;
        selectEl.innerHTML = '<option value="">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>';
        Array.from(values).sort().forEach(v => {
          const opt = document.createElement('option');
          opt.value = v;
          opt.textContent = v;
          selectEl.appendChild(opt);
        });
        if (current && Array.from(values).includes(current)) {
          selectEl.value = current;
        }
      }

      fillSelect(filterProvince, provinces);
      fillSelect(filterDistrict, districts);
      fillSelect(filterSubdist , subs);
    }

    function levelBadge(level) {
      const lv = Number(level) || 0;
      let cls = 'level-1';
      let text = `‡∏£‡∏∞‡∏î‡∏±‡∏ö ${lv}`;

      if (lv === 1) { cls = 'level-1'; text += ' - ‡∏ô‡πâ‡∏≥‡πÅ‡∏ó‡∏ö‡πÑ‡∏°‡πà‡πÑ‡∏´‡∏•'; }
      else if (lv === 2) { cls = 'level-2'; text += ' - ‡∏ô‡πâ‡∏≥‡πÑ‡∏´‡∏•‡∏ä‡πâ‡∏≤'; }
      else if (lv === 3) { cls = 'level-3'; text += ' - ‡πÑ‡∏´‡∏•‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á'; }
      else if (lv === 4) { cls = 'level-4'; text += ' - ‡πÑ‡∏´‡∏•‡πÅ‡∏£‡∏á'; }
      else if (lv === 5) { cls = 'level-5'; text += ' - ‡πÑ‡∏´‡∏•‡πÅ‡∏£‡∏á‡∏°‡∏≤‡∏Å'; }

      return `<span class="level-badge ${cls}">${text}</span>`;
    }

    function formatRegion(r = {}) {
      const parts = [];
      if (r.village)    parts.push(r.village);
      if (r.subdistrict)parts.push(r.subdistrict);
      if (r.district)   parts.push(r.district);
      if (r.province)   parts.push(r.province);
      return parts.join(' / ') || '-';
    }

    function renderTable() {
      const p = filterProvince.value;
      const d = filterDistrict.value;
      const s = filterSubdist.value;
      const t = filterText.value.trim().toLowerCase();

      const filtered = allCases.filter((c) => {
        const r = c.region || {};
        if (p && r.province !== p) return false;
        if (d && r.district !== d) return false;
        if (s && r.subdistrict !== s) return false;

        if (t) {
          const namePhone = `${c.name || ''} ${c.phone || ''}`.toLowerCase();
          if (!namePhone.includes(t)) return false;
        }
        return true;
      });

      if (!filtered.length) {
        tbody.innerHTML = `
          <tr><td colspan="8" class="empty">
            ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏Ñ‡∏™‡∏ó‡∏µ‡πà‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏ï‡∏≤‡∏°‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
          </td></tr>`;
        return;
      }

      tbody.innerHTML = filtered.map((c, idx) => {
        const lat = c.lat;
        const lng = c.lng;
        const hasLoc = typeof lat === "number" && typeof lng === "number";

        let mapLinks = "-";
        if (hasLoc) {
          const gmapsUrl   = `https://www.google.com/maps/search/?api=1&query=${lat},${lng}`;
          const appleUrl   = `http://maps.apple.com/?ll=${lat},${lng}`;
          const osmandUrl  = `https://osmand.net/map?pin=${lat},${lng}#17/${lat}/${lng}`;
          const organicUrl = `https://omaps.app/map?v=1&ll=${lat},${lng}`;
          const mapsmeUrl  = `mapsme://map?ll=${lat},${lng}&n=‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ú‡∏π‡πâ‡∏õ‡∏£‡∏∞‡∏™‡∏ö‡∏†‡∏±‡∏¢`;

          mapLinks = `
            <a class="btn-map" href="${gmapsUrl}" target="_blank">Google</a><br>
            <a class="btn-map" href="${appleUrl}" target="_blank">Apple</a><br>
            <a class="btn-map" href="${mapsmeUrl}">Maps.me</a><br>
            <a class="btn-map" href="${osmandUrl}" target="_blank">OsmAnd</a><br>
            <a class="btn-map" href="${organicUrl}" target="_blank">Organic</a>
          `;
        }

        return `
          <tr>
            <td>${idx + 1}</td>
            <td>${c.name || '-'}</td>
            <td>${c.phone || '-'}</td>
            <td>${formatRegion(c.region)}</td>
            <td>${levelBadge(c.waterLevel)}</td>
            <td>${c.note ? c.note.replace(/\n/g, '<br>') : '-'}</td>
            <td>
              ${mapLinks}<br>
              <button class="btn-finish" onclick="closeCase('${c.id}')">
                ‚úî ‡∏ä‡πà‡∏ß‡∏¢‡πÅ‡∏•‡πâ‡∏ß
              </button>
            </td>
            <td><span class="status-tag">‡∏£‡∏≠‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠</span></td>
          </tr>
        `;
      }).join('');
    }

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏õ‡∏¥‡∏î‡πÄ‡∏Ñ‡∏™ ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å onclick
    window.closeCase = async function (caseId) {
      if (!confirm("‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏¥‡∏î‡πÄ‡∏Ñ‡∏™‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?")) return;

      try {
        await updateDoc(doc(db, "cases", caseId), {
          status: "closed",
          closedAt: serverTimestamp()
        });
        alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ß‡πà‡∏≤ '‡∏ä‡πà‡∏ß‡∏¢‡πÅ‡∏•‡πâ‡∏ß' ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
        // onSnapshot ‡∏à‡∏∞‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÉ‡∏´‡πâ‡πÄ‡∏≠‡∏á
      } catch (err) {
        console.error(err);
        alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏õ‡∏¥‡∏î‡πÄ‡∏Ñ‡∏™‡πÑ‡∏î‡πâ");
      }
    };

    // event filter
    filterProvince.addEventListener('change', renderTable);
    filterDistrict.addEventListener('change', renderTable);
    filterSubdist.addEventListener('change', renderTable);
    filterText.addEventListener('input', renderTable);

    // ‡πÄ‡∏£‡∏¥‡πà‡∏° subscribe ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
    subscribeOpenCases();
  </script>
</body>
</html>
