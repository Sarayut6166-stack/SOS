<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏π‡πâ‡∏õ‡∏£‡∏∞‡∏™‡∏ö‡∏†‡∏±‡∏¢‡∏ô‡πâ‡∏≥‡∏ó‡πà‡∏ß‡∏°</title>

  <!-- ‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    body { margin:0; font-family: system-ui, -apple-system, sans-serif; background:#f5f5f5; }
    #map { height: 45vh; }

    .container { max-width: 480px; margin: auto; padding: 12px; }
    h2 { margin: 8px 0; text-align:center; }
    p  { font-size:14px; color:#555; }

    label {
      display:block;
      margin-top:8px;
      font-size:14px;
    }
    input, textarea, select, button {
      width: 100%;
      margin-top:4px;
      padding: 8px;
      font-size: 15px;
      box-sizing: border-box;
      border-radius:8px;
      border:1px solid #ccc;
    }
    textarea { resize: vertical; }

    button {
      margin-top:14px;
      background:#e53935;
      color:#fff;
      border:none;
      font-weight:600;
      box-shadow:0 3px 8px rgba(0,0,0,0.2);
    }

    #status { font-size:13px; margin-top:6px; }
  </style>
</head>
<body>
  <div id="map"></div>

  <div class="container">
    <h2>üìç ‡πÅ‡∏à‡πâ‡∏á‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ú‡∏π‡πâ‡∏õ‡∏£‡∏∞‡∏™‡∏ö‡∏†‡∏±‡∏¢</h2>
    <p>‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏´‡∏°‡∏∏‡∏î‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ GPS ‡∏à‡∏≤‡∏Å‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á</p>

    <form id="reportForm">
      <label>‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÅ‡∏à‡πâ‡∏á‡∏´‡∏£‡∏∑‡∏≠‡∏ú‡∏π‡πâ‡∏õ‡∏£‡∏∞‡∏™‡∏ö‡∏†‡∏±‡∏¢</label>
      <input name="name" required>

      <label>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠</label>
      <input name="phone" required>

      <label>‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</label>
      <select name="province" required>
        <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</option>
        <option value="‡∏™‡∏á‡∏Ç‡∏•‡∏≤">‡∏™‡∏á‡∏Ç‡∏•‡∏≤</option>
        <!-- ‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î ‡πÉ‡∏™‡πà option ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÑ‡∏î‡πâ -->
      </select>

      <label>‡∏≠‡∏≥‡πÄ‡∏†‡∏≠</label>
      <select name="district" required>
        <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏≥‡πÄ‡∏†‡∏≠</option>
        <option value="‡∏´‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà">‡∏´‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà</option>
        <option value="‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏™‡∏á‡∏Ç‡∏•‡∏≤">‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏™‡∏á‡∏Ç‡∏•‡∏≤</option>
        <option value="‡∏ô‡∏≤‡∏´‡∏°‡πà‡∏≠‡∏°">‡∏ô‡∏≤‡∏´‡∏°‡πà‡∏≠‡∏°</option>
      </select>

      <label>‡∏ï‡∏≥‡∏ö‡∏• / ‡πÄ‡∏Ç‡∏ï / ‡πÄ‡∏ó‡∏®‡∏ö‡∏≤‡∏•</label>
      <select name="subdistrict" required>
        <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏≥‡∏ö‡∏• / ‡πÄ‡∏Ç‡∏ï / ‡πÄ‡∏ó‡∏®‡∏ö‡∏≤‡∏•</option>
        <option value="‡∏ö‡πâ‡∏≤‡∏ô‡∏û‡∏£‡∏∏">‡∏ö‡πâ‡∏≤‡∏ô‡∏û‡∏£‡∏∏</option>
        <option value="‡∏Ñ‡∏•‡∏≠‡∏á‡πÅ‡∏´">‡∏Ñ‡∏•‡∏≠‡∏á‡πÅ‡∏´</option>
        <option value="‡∏û‡∏∞‡∏ß‡∏á">‡∏û‡∏∞‡∏ß‡∏á</option>
      </select>

      <label>‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô / ‡∏ä‡∏∏‡∏°‡∏ä‡∏ô</label>
      <select name="village" required>
        <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô / ‡∏ä‡∏∏‡∏°‡∏ä‡∏ô</option>
        <option value="‡∏´‡∏°‡∏π‡πà 1">‡∏´‡∏°‡∏π‡πà 1</option>
        <option value="‡∏´‡∏°‡∏π‡πà 2">‡∏´‡∏°‡∏π‡πà 2</option>
        <option value="‡∏´‡∏°‡∏π‡πà 3">‡∏´‡∏°‡∏π‡πà 3</option>
        <option value="‡∏´‡∏°‡∏π‡πà 4">‡∏´‡∏°‡∏π‡πà 4</option>
      </select>

      <label>‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏£‡∏á‡∏Ç‡∏≠‡∏á‡∏Å‡∏£‡∏∞‡πÅ‡∏™‡∏ô‡πâ‡∏≥</label>
      <select name="waterLevel" required>
        <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏£‡∏á‡∏Å‡∏£‡∏∞‡πÅ‡∏™‡∏ô‡πâ‡∏≥</option>
        <option value="1">‡∏£‡∏∞‡∏î‡∏±‡∏ö 1 - ‡∏ô‡πâ‡∏≥‡πÅ‡∏ó‡∏ö‡πÑ‡∏°‡πà‡πÑ‡∏´‡∏•</option>
        <option value="2">‡∏£‡∏∞‡∏î‡∏±‡∏ö 2 - ‡∏ô‡πâ‡∏≥‡πÑ‡∏´‡∏•‡∏ä‡πâ‡∏≤</option>
        <option value="3">‡∏£‡∏∞‡∏î‡∏±‡∏ö 3 - ‡∏ô‡πâ‡∏≥‡πÑ‡∏´‡∏•‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á</option>
        <option value="4">‡∏£‡∏∞‡∏î‡∏±‡∏ö 4 - ‡∏ô‡πâ‡∏≥‡πÑ‡∏´‡∏•‡πÅ‡∏£‡∏á</option>
        <option value="5">‡∏£‡∏∞‡∏î‡∏±‡∏ö 5 - ‡∏ô‡πâ‡∏≥‡πÑ‡∏´‡∏•‡πÅ‡∏£‡∏á‡∏°‡∏≤‡∏Å ‡∏≠‡∏±‡∏ô‡∏ï‡∏£‡∏≤‡∏¢‡∏™‡∏π‡∏á</option>
      </select>

      <label>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</label>
      <textarea name="note" rows="3" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏°‡∏µ‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢‡∏ï‡∏¥‡∏î‡πÄ‡∏ï‡∏µ‡∏¢‡∏á, ‡πÄ‡∏î‡πá‡∏Å‡πÄ‡∏•‡πá‡∏Å, ‡∏≠‡∏¢‡∏π‡πà‡∏ä‡∏±‡πâ‡∏ô 2 ‡∏Ø‡∏•‡∏Ø"></textarea>

      <button type="submit">‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏õ‡∏£‡∏∞‡∏™‡∏ö‡∏†‡∏±‡∏¢</button>
    </form>

    <p id="status"></p>
  </div>

  <!-- Leaflet -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <!-- Firebase config (‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô repo ‡πÅ‡∏•‡πâ‡∏ß) -->
  <script src="firebase-config.js"></script>

  <!-- Firebase v10 ‡πÅ‡∏ö‡∏ö‡πÇ‡∏°‡∏î‡∏π‡∏• -->
  <script type="module">
    import { initializeApp } 
      from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { 
      getFirestore, 
      collection, 
      addDoc, 
      serverTimestamp 
    } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

    const app = initializeApp(firebaseConfig);
    const db  = getFirestore(app);

    // ---------- ‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà ----------
    const map = L.map('map').setView([7.0, 100.5], 11);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19
    }).addTo(map);

    let marker = L.marker([7.0, 100.5], { draggable:true }).addTo(map);

    // ‡πÉ‡∏ä‡πâ GPS ‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(pos => {
        const lat = pos.coords.latitude;
        const lng = pos.coords.longitude;
        marker.setLatLng([lat, lng]);
        map.setView([lat, lng], 15);
      });
    }

    // ‡∏Ñ‡∏•‡∏¥‡∏Å‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡πâ‡∏≤‡∏¢‡∏´‡∏°‡∏∏‡∏î
    map.on('click', e => {
      marker.setLatLng(e.latlng);
    });

    // ---------- ‡∏™‡πà‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏° ----------
    const form = document.getElementById('reportForm');
    const statusEl = document.getElementById('status');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      const latlng = marker.getLatLng();

      const data = {
        name : form.name.value,
        phone: form.phone.value,
        note : form.note.value,
        lat  : latlng.lat,
        lng  : latlng.lng,
        region: {
          province   : form.province.value,
          district   : form.district.value,
          subdistrict: form.subdistrict.value,
          village    : form.village.value
        },
        waterLevel: Number(form.waterLevel.value), // 1‚Äì5 ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏£‡∏á‡∏ô‡πâ‡∏≥
        status    : 'open',
        createdAt : serverTimestamp()
      };

      statusEl.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...';

      try {
        await addDoc(collection(db, 'cases'), data);
        statusEl.textContent = '‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ ‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏£‡∏±‡∏ö ‚úÖ';
        form.reset();
      } catch (err) {
        console.error(err);
        statusEl.textContent = '‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á';
      }
    });
  </script>
</body>
</html>
